-- Movie Database Schema
CREATE TABLE ACTOR (
    Act_id INT PRIMARY KEY,
    Act_Name VARCHAR(50),
    Act_Gender VARCHAR(10)
);

CREATE TABLE DIRECTOR (
    Dir_id INT PRIMARY KEY,
    Dir_Name VARCHAR(50),
    Dir_Phone VARCHAR(15)
);

CREATE TABLE MOVIES (
    Mov_id INT PRIMARY KEY,
    Mov_Title VARCHAR(100),
    Mov_Year YEAR,
    Mov_Lang VARCHAR(50),
    Dir_id INT,
    FOREIGN KEY (Dir_id) REFERENCES DIRECTOR(Dir_id)
);

CREATE TABLE MOVIE_CAST (
    Act_id INT,
    Mov_id INT,
    Role VARCHAR(50),
    FOREIGN KEY (Act_id) REFERENCES ACTOR(Act_id),
    FOREIGN KEY (Mov_id) REFERENCES MOVIES(Mov_id)
);

CREATE TABLE RATING (
    Mov_id INT,
    Rev_Stars INT,
    FOREIGN KEY (Mov_id) REFERENCES MOVIES(Mov_id)
);

-- Queries for Chit 23
-- 1. List all movies directed by 'Hitchcock'
SELECT Mov_Title FROM MOVIES JOIN DIRECTOR ON MOVIES.Dir_id = DIRECTOR.Dir_id WHERE Dir_Name = 'Hitchcock';

-- 2. Movies where an actor acted in two or more movies
SELECT Mov_Title FROM MOVIES 
JOIN MOVIE_CAST ON MOVIES.Mov_id = MOVIE_CAST.Mov_id 
GROUP BY MOVIE_CAST.Act_id 
HAVING COUNT(DISTINCT MOVIE_CAST.Mov_id) >= 2;

-- 3. Actors who acted before 2000 and after 2015
SELECT DISTINCT Act_Name FROM ACTOR 
JOIN MOVIE_CAST ON ACTOR.Act_id = MOVIE_CAST.Act_id
JOIN MOVIES ON MOVIE_CAST.Mov_id = MOVIES.Mov_id
WHERE MOVIES.Mov_Year < 2000 OR MOVIES.Mov_Year > 2015;

-- 4. Movies and their ratings, sorted by title
SELECT Mov_Title, Rev_Stars FROM MOVIES 
JOIN RATING ON MOVIES.Mov_id = RATING.Mov_id 
ORDER BY Mov_Title;

-- 5. Update rating to 5 for all movies directed by 'Steven Spielberg'
UPDATE RATING 
SET Rev_Stars = 5 
WHERE Mov_id IN (SELECT Mov_id FROM MOVIES WHERE Dir_id = (SELECT Dir_id FROM DIRECTOR WHERE Dir_Name = 'Steven Spielberg'));
